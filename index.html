<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drag & Drop Value Ranker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            touch-action: manipulation;
        }
        .sortable-ghost {
            opacity: 0.4;
            background: #c8ebfb !important;
        }
        .value-item {
            cursor: grab;
            user-select: none;
        }
        .value-item:active {
            cursor: grabbing;
        }
        .ranking-tier {
            display: flex;
            flex-wrap: wrap; /* Allow items to wrap in a tier */
            gap: 8px;
            padding: 8px;
            border-radius: 8px;
            min-height: 60px; /* Reduced min-height for smaller items */
            align-items: center;
            justify-content: center;
            border: 2px dashed #e5e7eb; /* Dashed border for all tiers */
            transition: background-color 0.2s, border-color 0.2s;
        }
        .ranking-tier.sortable-ghost {
             background: #e0f2fe;
             border-color: #38bdf8;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex items-center justify-center min-h-screen p-4">

    <div id="app" class="w-full max-w-4xl mx-auto">
       
        <!-- Main Ranking View -->
        <div id="ranking-view">
             <header class="text-center mb-6">
                <h1 class="text-2xl font-bold text-gray-700">Rank Your Values</h1>
                <p class="text-gray-500">Drag values to the spectrum. Drop items next to each other to rank them equally. Items left in the lot will be unranked.</p>
            </header>

            <main class="grid grid-cols-1 md:grid-cols-2 gap-5">
                <!-- Left Side: Ranking Spectrum -->
                <div class="flex flex-col">
                    <div class="text-center px-2 mb-2">
                        <span class="font-bold text-green-600">More Valued</span>
                    </div>
                    <div id="ranking-list-container" class="items-center relative h-[500px] w-full bg-white rounded-xl shadow-inner p-3 space-y-2 overflow-y-auto">
                        <!-- Ranking Tiers will be dynamically added here -->
                    </div>
                    <div class="text-center px-2 mt-2">
                        <span class="font-bold text-red-600">Less Valued</span>
                    </div>
                </div>

                <!-- Right Side: Parking Lot -->
                <div class="flex flex-col">
                    <h2 class="font-bold text-center text-gray-600 mb-2">Parking Lot</h2>
                    <div id="parking-lot-list" class="bg-gray-200 rounded-xl shadow-inner p-3 space-y-2 h-[500px] overflow-y-auto">
                        <!-- Initial unranked items -->
                    </div>
                    <div class="mt-4 flex gap-2">
                        <input id="new-item-input" type="text" placeholder="Add your own value..." class="flex-grow p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
                        <button id="add-item-button" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 transition">Add</button>
                    </div>
                </div>
            </main>
            
            <footer class="text-center mt-6">
                <button id="finish-button" class="bg-green-500 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-green-600 transition">Finish Ranking</button>
            </footer>
        </div>

        <!-- Results View -->
        <div id="results-view" class="hidden">
             <header class="text-center mb-6">
                <h1 class="text-3xl font-bold text-gray-700">Your Value Ranking</h1>
            </header>
            <div class="bg-white p-6 rounded-xl shadow-lg max-w-md mx-auto">
                <div id="results-container" class="space-y-4"></div>
                <button id="restart-button" class="w-full mt-6 bg-blue-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-blue-700 transition">Start Over</button>
            </div>
        </div>
    </div>

    <script>
        const initialValues = [
            "God", "Honesty", "Trust", "Peace", "Family", "Friends", "Health", "Recreation", "Career"
        ];

        // DOM Elements
        const parkingLotListEl = document.getElementById('parking-lot-list');
        const rankingListContainerEl = document.getElementById('ranking-list-container');
        const newItemInput = document.getElementById('new-item-input');
        const addItemButton = document.getElementById('add-item-button');
        const finishButton = document.getElementById('finish-button');
        const restartButton = document.getElementById('restart-button');
        const rankingView = document.getElementById('ranking-view');
        const resultsView = document.getElementById('results-view');
        const resultsContainer = document.getElementById('results-container');
        
        function initializeApp() {
            parkingLotListEl.innerHTML = '';
            rankingListContainerEl.innerHTML = '';

            initialValues.forEach(value => {
                parkingLotListEl.appendChild(createValueItem(value));
            });
            
            // --- SortableJS Initialization ---
            const sharedSortableOptions = {
                group: 'shared-values',
                animation: 150,
                ghostClass: 'sortable-ghost',
            };

            // Parking Lot (items can be moved to/from here)
            new Sortable(parkingLotListEl, sharedSortableOptions);

            // Ranking Spectrum (the main container for tiers)
            new Sortable(rankingListContainerEl, {
                ...sharedSortableOptions,
                onAdd: function(evt) {
                    const droppedEl = evt.item;

                    // If a tier is being moved, SortableJS handles it. Do nothing.
                    if (droppedEl.classList.contains('ranking-tier')) return;

                    // If a value-item is dropped here, wrap it in a new tier.
                    const newTier = createRankingTier();
                    
                    // Replace the dropped item with our new tier in the container
                    evt.to.replaceChild(newTier, droppedEl);
                    
                    // And move the item inside that new tier
                    newTier.appendChild(droppedEl);
                }
            });
        }

        // --- Element Creation ---
        function createValueItem(text) {
            const div = document.createElement('div');
            div.className = 'value-item bg-white p-2 text-sm rounded-lg shadow text-center border border-gray-200';
            div.textContent = text;
            return div;
        }

        function createRankingTier() {
            const tierEl = document.createElement('div');
            tierEl.className = 'ranking-tier';
            
            // Each tier is also a sortable list that can accept/provide value items
            new Sortable(tierEl, {
                group: 'shared-values',
                animation: 150,
                ghostClass: 'sortable-ghost',
                onEnd: function(evt) {
                    // After a drag operation, if the source tier is now empty, remove it.
                    const fromTier = evt.from;
                    if (fromTier && fromTier.classList.contains('ranking-tier') && fromTier.children.length === 0) {
                        fromTier.remove();
                    }
                }
            });
            return tierEl;
        }
        
        // --- Event Handlers ---
        function addNewItem() {
            const text = newItemInput.value.trim();
            if (!text) return;

            // Check if the item already exists anywhere on the page
            const allItems = document.querySelectorAll('.value-item');
            const itemExists = Array.from(allItems).some(item => item.textContent === text);

            if (!itemExists) {
                parkingLotListEl.appendChild(createValueItem(text));
                newItemInput.value = '';
            } else {
                alert("This value already exists."); // User feedback for duplicates
            }
        }

        function showResults() {
            rankingView.classList.add('hidden');
            resultsView.classList.remove('hidden');
            resultsContainer.innerHTML = '';

            const rankedTiers = Array.from(rankingListContainerEl.children)
                .filter(tier => tier.children.length > 0)
                .map(tier => Array.from(tier.children).map(item => item.textContent));

            if (rankedTiers.length > 0) {
                const rankedSection = document.createElement('div');
                rankedSection.innerHTML = '<h2 class="text-xl font-bold mb-2 text-gray-600">Ranked</h2>';
                rankedTiers.forEach((tierItems, index) => {
                    const rankDiv = document.createElement('div');
                    rankDiv.className = 'flex items-start mb-2';
                    let itemsHtml = tierItems.map(item => `<span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full">${item}</span>`).join('');
                    rankDiv.innerHTML = `
                        <div class="w-8 h-8 flex-shrink-0 flex items-center justify-center bg-gray-200 rounded-full font-bold text-gray-600 mr-4">${index + 1}</div>
                        <div class="flex flex-wrap gap-2">${itemsHtml}</div>
                    `;
                    rankedSection.appendChild(rankDiv);
                });
                resultsContainer.appendChild(rankedSection);
            }
            
            const unrankedItems = Array.from(parkingLotListEl.children).map(item => item.textContent);
            if (unrankedItems.length > 0) {
                 const unrankedSection = document.createElement('div');
                 unrankedSection.innerHTML = '<h2 class="text-xl font-bold mt-6 mb-2 text-gray-600">Unranked</h2>';
                 let itemsHtml = unrankedItems.map(item => `<span class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full">${item}</span>`).join('');
                 unrankedSection.innerHTML += `<div class="flex flex-wrap gap-2">${itemsHtml}</div>`;
                 resultsContainer.appendChild(unrankedSection);
            }

            if (rankedTiers.length === 0 && unrankedItems.length === 0) {
                 resultsContainer.innerHTML = '<p class="text-gray-500 text-center">You haven\'t ranked anything yet!</p>';
            }
        }

        // --- Event Listeners ---
        addItemButton.addEventListener('click', addNewItem);
        newItemInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addNewItem();
        });
        finishButton.addEventListener('click', showResults);
        restartButton.addEventListener('click', () => {
            resultsView.classList.add('hidden');
            rankingView.classList.remove('hidden');
            initializeApp();
        });

        // --- Initial Load ---
        initializeApp();
    </script>
</body>
</html>
